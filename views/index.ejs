<!DOCTYPE html>
<html>
  <head>
    <title>Wine Inventory</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.15.0/css/mdb.min.css" rel="stylesheet">
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.15.0/js/mdb.min.js"></script>
    <!-- MDBootstrap Datatables  -->
    <link href="/stylesheets/mdb/addons/datatables.min.css" rel="stylesheet"/>
    <!-- MDBootstrap Datatables  -->
    <script src="/javascripts/mdb/addons/datatables.min.js" type="text/javascript"></script>
  </head>
  <body>
  <div class="text-center">
    <h1 class="pink darken-4 py-2 text-white">Wine Inventory <i class="fas fa-wine-glass-alt"></i></h1>
  </div>
  <div class="container text-center mt-3">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
           aria-selected="true">Inventory</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="drinked-tab" data-toggle="tab" href="#drinked" role="tab" aria-controls="profile"
           aria-selected="false">Drinked</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="insertWine-tab" data-toggle="tab" href="#insertWine" role="tab" aria-controls="contact"
           aria-selected="false">Insert Wine</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="info-tab" data-toggle="tab" href="#info" role="tab" aria-controls="info"
           aria-selected="false">General Informations</a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <table id="dtBasicExample" class="container table table-striped table-bordered" cellspacing="0" width="100%">
          <thead>
          <tr>
            <th class="th-sm">Name</th>
            <th class="th-sm">Year</th>
            <th class="th-sm">Producer</th>
            <th class="th-sm">Type</th>
            <th class="th-sm">Category</th>
            <th class="th-sm">Quantity</th>
            <th class="th-sm">Size</th>
            <th class="th-sm">Location</th>
            <th class="th-sm">Comment</th>
            <th class="th-sm">Action</th>
          </tr>
          </thead>
          <tbody>
          <% for (var i = 0; i < vini.length; i++) { %>
            <tr>
              <td><%=vini[i].nome%></td>
              <td><%=vini[i].annata%></td>
              <td><%=vini[i].nome_produttore%></td>
              <td><%=vini[i].tipo%></td>
              <td><%=vini[i].nome_categoria%></td>
              <td><%=vini[i].quantita%></td>
              <td><%=vini[i].size%> L.</td>
              <td><%=vini[i].luogo%></td>
              <td><%=vini[i].comment%></td>
              <td><button onclick="setId(<%=vini[i].id_vino%>)" data-toggle="modal" data-target="#confirmModal" data-wineid="<%=vini[i].id_vino%>" class="btn btn-primary btn-md pink darken-4"><i class="fas fa-wine-glass-alt"></i></button></td>
            </tr>
          <%}%>
          </tbody>
          <tfoot>
          <tr>
            <th>Name</th>
            <th>Year</th>
            <th>Producer</th>
            <th>Type</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Size</th>
            <th>Location</th>
            <th>Comment</th>
            <th>Action</th>
          </tr>
          </tfoot>
        </table>
      </div>
      <div class="tab-pane fade" id="drinked" role="tabpanel" aria-labelledby="profile-tab">
        <table id="dtDrinked" class="container table table-striped table-bordered" cellspacing="0" width="100%">
          <thead>
          <tr>
            <th class="th-sm">Name</th>
            <th class="th-sm">Year</th>
            <th class="th-sm">Producer</th>
            <th class="th-sm">Type</th>
            <th class="th-sm">Category</th>
            <th class="th-sm">Quantity</th>
            <th class="th-sm">Size</th>
            <th class="th-sm">Location</th>
            <th class="th-sm">Comment</th>
          </tr>
          </thead>
          <tbody>
          <% for (var i = 0; i < drinked.length; i++) { %>
          <tr>
            <td><%=drinked[i].nome%></td>
            <td><%=drinked[i].annata%></td>
            <td><%=drinked[i].nome_produttore%></td>
            <td><%=drinked[i].tipo%></td>
            <td><%=drinked[i].nome_categoria%></td>
            <td><%=drinked[i].quantita%></td>
            <td><%=drinked[i].size%> L.</td>
            <td><%=drinked[i].luogo%></td>
            <td><%=drinked[i].comment%></td>
          </tr>
          <%}%>
          </tbody>
          <tfoot>
          <tr>
            <th>Name</th>
            <th>Year</th>
            <th>Producer</th>
            <th>Type</th>
            <th>Category</th>
            <th>Quantity</th>
            <th >Size</th>
            <th>Location</th>
            <th>Comment</th>
          </tr>
          </tfoot>
        </table>
      </div>
      <div class="tab-pane fade" id="insertWine" role="tabpanel" aria-labelledby="contact-tab">
        <!-- Default form login -->
        <form class="text-center p-5">
          <h3 class=" mb-4">Add New Wine to Inventory</h3>
          <div class="container text-center mx-auto">
            <input type="text" id="nomeNewWine" class="form-control mb-4 mx-auto col-md-6" placeholder="Name">
            <select class="browser-default custom-select mb-4 mx-auto col-md-6" id="produttore">
              <option selected value="undefined">Producer...</option>
              <%
              for (let i = 0; i < producers.length; i++) { %>
                <option value="<%=producers[i].id_produttore%>"><%=producers[i].nome_produttore%></option>
              <%}%>
            </select>
            <select class="browser-default custom-select mb-4 mx-auto col-md-6" id="tipo">
              <option selected value="undefined">Grapes...</option>
              <%
              for (let i = 0; i < grapes.length; i++) { %>
              <option value="<%=grapes[i].id_tipo%>"><%=grapes[i].tipo%></option>
              <%}%>
            </select>
            <input type="number" id="yearNew" class="form-control mb-4 mx-auto col-md-6" placeholder="Year">
            <input type="number" id="quantityNew" class="form-control mb-4 mx-auto col-md-6" placeholder="Quantity">
            <select class="browser-default custom-select mb-4 mx-auto col-md-6" id="dimensione">
              <option selected value="undefined">Size...</option>
              <%
              for (let i = 0; i < sizes.length; i++) { %>
                <option value="<%=sizes[i].id_dimensione%>"><%=sizes[i].size%> l.</option>
              <%}%>
            </select>
            <select class="browser-default custom-select mb-4 mx-auto col-md-6" id="categoria">
              <option selected value="undefined">Category...</option>
              <%
              for (let i = 0; i < categories.length; i++) { %>
                <option value="<%=categories[i].id_categoria%>"><%=categories[i].nome_categoria%></option>
              <%}%>
            </select>
            <select class="browser-default custom-select mb-4 mx-auto col-md-6" id="luogo">
              <option selected value="undefined">Position...</option>
              <%
              for (let i = 0; i < positions.length; i++) { %>
                <option value="<%=positions[i].id_luogo%>"><%=positions[i].nome%></option>
              <%}%>
            </select>
            <div class="form-group mb-4 mx-auto col-md-6">
              <label for="exampleFormControlTextarea2">Comment</label>
              <textarea class="form-control rounded-0" id="comment" rows="3"></textarea>
            </div>
            <button class="btn btn-info btn-block mb-4 mx-auto col-md-6 pink darken-4" id="insertNewWine">Insert Wine</button>
          </div>
        </form>
      </div>
      <div class="tab-pane fade" id="info" role="tabpanel" aria-labelledby="info-tab">
        <h3 class="mt-5">General Infos About Inventory</h3>
        <div class="container text-left">
          <p>Total bottles in Inventory : <%=totalInfo[0].bottiglie%></p>
          <p>Total liters in Inventory : <%=totalInfo[0].litri%> L.</p>
          <p>Total drinked bottles : <%=drinkedInfo[0].bottiglie%></p>
          <p>Total drinked liters : <%=drinkedInfo[0].litri%> L.</p>
          <p>Total Normal Size in Inventory : </p>
          <p>Total Magnum in Inventory : </p>
          <p>Total Double Magnum in Inventory : </p>
        </div>
      </div>
    </div>
    <% console.log(totalInfo[0].bottiglie)%>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Confirm</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Drinked ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
          <button onclick="drinkWine(<%=vini[0].id_vino%>)" class="btn btn-primary pink darken-4"><i class="fas fa-wine-glass-alt"></i></button>
        </div>
      </div>
    </div>
  </div>
  </body>
<script>
  $(document).ready(function () {
    $('#dtBasicExample').DataTable();
    $('.dataTables_length').addClass('bs-select');
    $('#dtDrinked').DataTable();
    $('.dataTables_length').addClass('bs-select');
  });

  let wineID = 0
  let setId = (id) => {
    wineID = id
  }

  let drinkWine = () => {
    $.ajax({
      method: "post",
      url: "/drinkWine",
      data: {
        vino: wineID
      },
      success: () => {
        location.reload()
      }
    });
  }

  $(document).ready(() => {
    $("#insertNewWine").click(() => {
      $.ajax({
        method: "post",
        url: "/insertWine",
        data: {
          nome: $("#nomeNewWine").val(),
          idTipo: $("#tipo").children("option:selected").val() !== 'undefined' ? $("#tipo").children("option:selected").val() : undefined,
          annata: $("#yearNew").val(),
          quantita: $("#quantityNew").val(),
          idDimensione: $("#dimensione").children("option:selected").val() !== 'undefined' ? $("#dimensione").children("option:selected").val() : undefined,
          idCategoria: $("#categoria").children("option:selected").val() !== 'undefined' ? $("#categoria").children("option:selected").val() : undefined,
          idLuogo: $("#luogo").children("option:selected").val() !== 'undefined' ? $("#luogo").children("option:selected").val() : undefined,
          idProduttore: $("#produttore").children("option:selected").val() !== 'undefined' ? $("#produttore").children("option:selected").val() : undefined,
          comment: $("#comment").val(),
        },
        success: () => {
          location.reload()
        }
      });
    })
  })

</script>
</html>
